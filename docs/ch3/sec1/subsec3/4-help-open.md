# 4.1.3.2 Git 辅助本地项目开发

## 目的

掌握如何利用 Git 管理本地开发流程。

## 内容

### 1。管理多个本地分支

在 Git 中，管理多个本地分支有助于开发与实验。每个功能、修复或实验都可以在独立的分支上进行，避免直接影响主分支的稳定性。通过合理的分支管理，可以确保代码的整洁和高效的开发流程。

  > **新手提示**：分支就像独立的代码副本，允许你在不影响主线代码的情况下进行修改。主分支（通常叫`main`或`master`）应保持稳定状态。

- **创建本地分支**：
  使用 `git branch` 命令创建新的分支。分支可以用来独立开发某个功能或实验性修改。创建分支后，使用 `git checkout` 命令切换到该分支进行开发。

  示例：

  ```bash
  git branch new-feature     # 创建一个新的分支
  git checkout new-feature   # 切换到新分支
  ```

  也可以通过 git checkout -b 命令同时创建并切换到新分支：

  ```bash
  git checkout -b new-feature   # 创建并切换到新分支
  ```

  > **命名建议**：  
  > - 功能分支：`feat/search-api`  
  > - 修复分支：`fix/login-error`  
  > - 实验分支：`exp/new-algorithm`  
  > 避免使用空格和特殊字符

- **切换分支**
  通过 git checkout 命令，开发者可以随时切换到不同的分支，继续开发其他功能或者修复问题。这使得多任务并行开发成为可能。

  ```bash
  git checkout main          # 切换到主分支
  git checkout feature-branch # 切换到指定的功能分支
  ```

  > **注意**：切换分支前请先提交或保存当前修改，否则未提交的更改会被带到新分支！

- **查看本地分支**：
  使用 git branch 命令可以列出所有本地分支，当前所在的分支会以*标记。此命令帮助开发者了解自己在哪个分支上工作。

  ```bash
  git branch
  ```

  输出示例：

  ```bash
  * feature-branch
  main
  develop
  ```

- **删除本地分支**：
  完成开发或实验后，可以使用 git branch -d 命令删除已经不再需要的分支。如果分支还没有被合并，会有提示，要求确认删除。可以使用-D 强制删除。

  ```bash
  git branch -d old-feature  # 删除本地的旧功能分支
  git branch -D feature-to-delete # 强制删除未合并的支
  ```

### 2。合并本地分支

当在不同分支上进行开发后，通常需要将其合并到主分支或其他分支上。这可以通过 git merge 命令来实现。

```mermaid
graph LR
    A[主分支 main] --> B[创建 feature]
    B --> C[在 feature 开发]
    C --> D[切回 main]
    D --> E[合并 feature]
```

- **合并分支**：
  在目标分支上执行 git merge 命令，将另一个分支的修改合并到当前分支。这是开发过程中最常用的操作之一。

  ```bash
  git checkout main         # 切换到主分支
  git merge new-feature     # 将新特性分支合并到主分支
  ```

  如果发生冲突，Git 会提示冲突的文件，开发者需要手动解决这些冲突。
- **解决合并冲突**：
  如果 Git 在合并时发现冲突，会标记出冲突的部分。开发者可以通过编辑文件来手动解决冲突。解决冲突后，执行 git add 命令标记冲突已解决，然后执行 git commit 提交合并结果

  ```bash
  # 解决冲突后，添加解决的文件
  git add conflicted-file
  # 提交合并结果
  git commit -m "Resolved merge conflict"
  ```

### 3。管理本地分支与远程分支的同步

本地与远程分支的同步通过三个核心命令实现：

1. **`git fetch`**：从远程仓库获取最新提交记录，但不修改本地代码。  
2. **`git pull`**：获取远程更新并自动合并到当前分支。  
3. **`git push`**：将本地提交推送到远程仓库。  

这三个命令共同维护本地与远程分支的一致性。

- **从远程获取最新更改**：
  使用 git fetch 命令可以从远程仓库获取最新的提交，而不自动合并。这可以帮助你查看远程仓库的变化，进行对比分析，而不会直接影响你的本地代码。

  ```bash
  git fetch origin       # 获取远程仓库的最新更改
  ```

- **拉取并合并远程更改**：
  使用 git pull 命令可以从远程仓库拉取更新并自动合并到本地分支。若使用 git pull --rebase，则采用 rebase 策略代替合并操作，历史记录将更加线性。

  ```bash
  git pull origin main   # 拉取远程主分支的更改并合并
  ```

- **推送本地更改到远程**：
  使用 git push 命令可以将本地提交上传到远程仓库。

  ```bash
  git push -u origin feature-branch      # 推送新分支（首次需设置上游）
  git push       # 后续推送（已设置上游）
  git push -f origin feature-branch      # 强制推送（谨慎使用！）
  ```

```mermaid
graph LR
   本地(Local) -- git push --> 远程(Remote)
   远程(Remote) -- git fetch/pull --> 本地(Local)
```

### 4。实验性开发与回滚

  Git 为开发者提供了很大的灵活性，特别是在进行实验性开发时。如果某个实验失败，开发者可以随时回滚到之前的稳定版本。你可以使用 git checkout、git reset 等命令来还原代码。

- **回滚到上一个提交**：
  如果当前修改没有经过提交，想要恢复到上一次的提交状态，可以使用 git checkout 来恢复文件。

  ```bash
  git checkout -- file.txt  # 恢复文件到上一次提交的状态
  ```

  如果想要撤销对某个文件的所有更改，可以使用：

  ```bash
  git checkout -- .         # 恢复所有文件到上一次提交的状态
  ```

- **重置分支到某个历史提交**：
  如果需要将分支重置到某个历史提交，可以使用 git reset 命令。--hard 选项会清除所有未提交的更改，回到指定的历史版本。

  ```bash
  git reset --hard HEAD~1  # 重置当前分支到上一个提交
  ```

  > **⚠️ 重要警告**：  
  > `--hard` 操作会永久丢弃未提交的修改！使用前确保：  
  >
  > 1. 真正需要放弃当前所有更改  
  > 2. 已备份重要代码片段  

  如果希望保留文件的修改但回到某个历史提交，可以使用--soft 选项：

  ```bash
  git reset --soft HEAD~1  # 保留修改，回到上一个提交
  ```

### 5。使用 Stash 保存临时修改

  在 Git 中，有时你可能需要暂时保存当前的工作进度，并切换到其他分支进行开发。这时可以使用 git stash 命令将未提交的更改保存到堆栈中。

  **典型使用场景**：  
  当你在分支 A 上开发到一半，突然需要：  

  1. 修复分支 B 的紧急 bug  
  2. 临时查看其他分支代码  
  3. 同步上游更新

  但又不想提交未完成的工作时，使用 stash 最合适。

- **保存当前修改**：
  使用 git stash 可以将当前的修改保存到堆栈中，然后恢复到干净的工作目录。

  ```bash
  git stash        # 保存当前修改
  git stash list   # 查看保存的 stash
  ```

- **恢复保存的修改**：
  使用 git stash pop 命令可以恢复最近保存的修改。该命令会将修改应用到当前分支，并从 stash 堆栈中删除。

  ```bash
  git stash pop    # 恢复最近保存的修改并从 stash 堆栈中删除
  ```

- **应用特定的 stash**：
  如果有多个保存的 stash，可以指定应用某个特定的 stash。

  ```bash
  git stash apply stash@{2}  # 恢复第二个保存的 stash
  ```

## 新手速查表

| 场景                | 命令                     | 注意事项                  |
|---------------------|--------------------------|--------------------------|
| 紧急切换任务        | `git stash`              | 后接 `git stash pop` 恢复 |
| 丢弃所有未提交修改  | `git checkout -- .`      | **不可逆操作**           |
| 安全删除分支        | `git branch -d 分支名`   | 先合并再删除             |
| 查看操作历史        | `git reflog`             | 误操作救命工具           |
| 检查远程状态        | `git remote show origin` | 显示远程分支跟踪关系     |

## 总结

   Git 帮助开发者在本地进行多分支管理，提供了灵活的开发与实验机制。通过合理的分支管理、合并与回滚操作，可以有效提升开发效率，并保持代码的整洁与可维护性。同时，借助 stash 功能，开发者能够灵活处理临时任务，避免丢失未完成的工作。Git 的本地开发流程为团队提供了更高效的协作机制，使得开发者能够更加专注于功能开发、问题解决与实验创新。
